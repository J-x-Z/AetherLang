/* Generated by AetherLang C Backend */
#include <stdint.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <immintrin.h>  /* SSE/AVX */

/* AetherLang Runtime */
static void aether_print(const char* s) { printf("%s", s); }
static void aether_println(const char* s) { printf("%s\n", s); }
static void aether_print_i64(int64_t n) { printf("%lld", (long long)n); }
static void aether_println_i64(int64_t n) { printf("%lld\n", (long long)n); }
static void aether_assert(bool c) { if(!c) { fprintf(stderr, "Assertion failed\n"); exit(1); } }

/* Struct Definitions */
struct Dual {
    float val;
    float deriv;
};

struct Dual* dual_var(float);
struct Dual* dual_const(float);
struct Dual* dual_add(struct Dual*, struct Dual*);
struct Dual* dual_sub(struct Dual*, struct Dual*);
struct Dual* dual_mul(struct Dual*, struct Dual*);
struct Dual* dual_div(struct Dual*, struct Dual*);
struct Dual* dual_neg(struct Dual*);
struct Dual* dual_exp(struct Dual*);
struct Dual* dual_log(struct Dual*);
struct Dual* dual_sin(struct Dual*);
struct Dual* dual_cos(struct Dual*);
struct Dual* dual_sqrt(struct Dual*);
struct Dual* dual_pow(struct Dual*, float);
struct Dual* dual_relu(struct Dual*);
struct Dual* dual_sigmoid(struct Dual*);
struct Dual* dual_tanh(struct Dual*);
float mse_grad(float, float);
float cross_entropy_grad(float, float);
struct Dual* example_derivative(float);

struct Dual* dual_var(float _arg0) {
    float _t0;
    float* _t2;
    float* _t3;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t1->val;
    *_t2 = _t0;
    _t3 = &_t1->deriv;
    *_t3 = 1;
    return _t1;
}

struct Dual* dual_const(float _arg0) {
    float _t0;
    float* _t2;
    float* _t3;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t1->val;
    *_t2 = _t0;
    _t3 = &_t1->deriv;
    *_t3 = 0;
    return _t1;
}

struct Dual* dual_add(struct Dual* _arg0, struct Dual* _arg1) {
    float _t10;
    float _t12;
    float _t4;
    float _t6;
    float* _t11;
    float* _t14;
    float* _t3;
    float* _t5;
    float* _t8;
    float* _t9;
    int64_t _t13;
    int64_t _t7;
    struct Dual* _t0;
    struct Dual* _t1;
    struct Dual* _t2;
    
    _t0 = _arg0;
    _t1 = _arg1;
    struct Dual _alloca__t2;
    _t2 = &_alloca__t2;
    _t3 = &_t0->val;
    _t4 = *_t3;
    _t5 = &_t1->val;
    _t6 = *_t5;
    _t7 = _t4 + _t6;
    _t8 = &_t2->val;
    *_t8 = _t7;
    _t9 = &_t0->deriv;
    _t10 = *_t9;
    _t11 = &_t1->deriv;
    _t12 = *_t11;
    _t13 = _t10 + _t12;
    _t14 = &_t2->deriv;
    *_t14 = _t13;
    return _t2;
}

struct Dual* dual_sub(struct Dual* _arg0, struct Dual* _arg1) {
    float _t10;
    float _t12;
    float _t4;
    float _t6;
    float* _t11;
    float* _t14;
    float* _t3;
    float* _t5;
    float* _t8;
    float* _t9;
    int64_t _t13;
    int64_t _t7;
    struct Dual* _t0;
    struct Dual* _t1;
    struct Dual* _t2;
    
    _t0 = _arg0;
    _t1 = _arg1;
    struct Dual _alloca__t2;
    _t2 = &_alloca__t2;
    _t3 = &_t0->val;
    _t4 = *_t3;
    _t5 = &_t1->val;
    _t6 = *_t5;
    _t7 = _t4 - _t6;
    _t8 = &_t2->val;
    *_t8 = _t7;
    _t9 = &_t0->deriv;
    _t10 = *_t9;
    _t11 = &_t1->deriv;
    _t12 = *_t11;
    _t13 = _t10 - _t12;
    _t14 = &_t2->deriv;
    *_t14 = _t13;
    return _t2;
}

struct Dual* dual_mul(struct Dual* _arg0, struct Dual* _arg1) {
    float _t10;
    float _t12;
    float _t15;
    float _t17;
    float _t4;
    float _t6;
    float* _t11;
    float* _t14;
    float* _t16;
    float* _t20;
    float* _t3;
    float* _t5;
    float* _t8;
    float* _t9;
    int64_t _t13;
    int64_t _t18;
    int64_t _t19;
    int64_t _t7;
    struct Dual* _t0;
    struct Dual* _t1;
    struct Dual* _t2;
    
    _t0 = _arg0;
    _t1 = _arg1;
    struct Dual _alloca__t2;
    _t2 = &_alloca__t2;
    _t3 = &_t0->val;
    _t4 = *_t3;
    _t5 = &_t1->val;
    _t6 = *_t5;
    _t7 = _t4 * _t6;
    _t8 = &_t2->val;
    *_t8 = _t7;
    _t9 = &_t0->val;
    _t10 = *_t9;
    _t11 = &_t1->deriv;
    _t12 = *_t11;
    _t13 = _t10 * _t12;
    _t14 = &_t0->deriv;
    _t15 = *_t14;
    _t16 = &_t1->val;
    _t17 = *_t16;
    _t18 = _t15 * _t17;
    _t19 = _t13 + _t18;
    _t20 = &_t2->deriv;
    *_t20 = _t19;
    return _t2;
}

struct Dual* dual_div(struct Dual* _arg0, struct Dual* _arg1) {
    float _t10;
    float _t12;
    float _t16;
    float _t18;
    float _t21;
    float _t23;
    float _t3;
    float _t5;
    float* _t11;
    float* _t14;
    float* _t15;
    float* _t17;
    float* _t20;
    float* _t22;
    float* _t27;
    float* _t2;
    float* _t4;
    float* _t9;
    int64_t _t13;
    int64_t _t19;
    int64_t _t24;
    int64_t _t25;
    int64_t _t26;
    int64_t _t6;
    int64_t _t7;
    struct Dual* _t0;
    struct Dual* _t1;
    struct Dual* _t8;
    
    _t0 = _arg0;
    _t1 = _arg1;
    _t2 = &_t1->val;
    _t3 = *_t2;
    _t4 = &_t1->val;
    _t5 = *_t4;
    _t6 = _t3 * _t5;
    _t7 = _t6;
    struct Dual _alloca__t8;
    _t8 = &_alloca__t8;
    _t9 = &_t0->val;
    _t10 = *_t9;
    _t11 = &_t1->val;
    _t12 = *_t11;
    _t13 = _t10 / _t12;
    _t14 = &_t8->val;
    *_t14 = _t13;
    _t15 = &_t0->deriv;
    _t16 = *_t15;
    _t17 = &_t1->val;
    _t18 = *_t17;
    _t19 = _t16 * _t18;
    _t20 = &_t0->val;
    _t21 = *_t20;
    _t22 = &_t1->deriv;
    _t23 = *_t22;
    _t24 = _t21 * _t23;
    _t25 = _t19 - _t24;
    _t26 = _t25 / _t7;
    _t27 = &_t8->deriv;
    *_t27 = _t26;
    return _t8;
}

struct Dual* dual_neg(struct Dual* _arg0) {
    float _t3;
    float _t4;
    float _t7;
    float _t8;
    float* _t2;
    float* _t5;
    float* _t6;
    float* _t9;
    struct Dual* _t0;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t0->val;
    _t3 = *_t2;
    _t4 = -_t3;
    _t5 = &_t1->val;
    *_t5 = _t4;
    _t6 = &_t0->deriv;
    _t7 = *_t6;
    _t8 = -_t7;
    _t9 = &_t1->deriv;
    *_t9 = _t8;
    return _t1;
}

struct Dual* dual_exp(struct Dual* _arg0) {
    float _t2;
    float _t8;
    float* _t10;
    float* _t1;
    float* _t6;
    float* _t7;
    int64_t _t3;
    int64_t _t4;
    int64_t _t9;
    struct Dual* _t0;
    struct Dual* _t5;
    
    _t0 = _arg0;
    _t1 = &_t0->val;
    _t2 = *_t1;
    expf(_t2);
    _t4 = _t3;
    struct Dual _alloca__t5;
    _t5 = &_alloca__t5;
    _t6 = &_t5->val;
    *_t6 = _t4;
    _t7 = &_t0->deriv;
    _t8 = *_t7;
    _t9 = _t4 * _t8;
    _t10 = &_t5->deriv;
    *_t10 = _t9;
    return _t5;
}

struct Dual* dual_log(struct Dual* _arg0) {
    float _t3;
    float _t7;
    float _t9;
    float* _t11;
    float* _t2;
    float* _t5;
    float* _t6;
    float* _t8;
    int64_t _t10;
    int64_t _t4;
    struct Dual* _t0;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t0->val;
    _t3 = *_t2;
    logf(_t3);
    _t5 = &_t1->val;
    *_t5 = _t4;
    _t6 = &_t0->deriv;
    _t7 = *_t6;
    _t8 = &_t0->val;
    _t9 = *_t8;
    _t10 = _t7 / _t9;
    _t11 = &_t1->deriv;
    *_t11 = _t10;
    return _t1;
}

struct Dual* dual_sin(struct Dual* _arg0) {
    float _t10;
    float _t3;
    float _t7;
    float* _t12;
    float* _t2;
    float* _t5;
    float* _t6;
    float* _t9;
    int64_t _t11;
    int64_t _t4;
    int64_t _t8;
    struct Dual* _t0;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t0->val;
    _t3 = *_t2;
    sinf(_t3);
    _t5 = &_t1->val;
    *_t5 = _t4;
    _t6 = &_t0->val;
    _t7 = *_t6;
    cosf(_t7);
    _t9 = &_t0->deriv;
    _t10 = *_t9;
    _t11 = _t8 * _t10;
    _t12 = &_t1->deriv;
    *_t12 = _t11;
    return _t1;
}

struct Dual* dual_cos(struct Dual* _arg0) {
    float _t11;
    float _t3;
    float _t7;
    float* _t10;
    float* _t13;
    float* _t2;
    float* _t5;
    float* _t6;
    int64_t _t12;
    int64_t _t4;
    int64_t _t8;
    int64_t _t9;
    struct Dual* _t0;
    struct Dual* _t1;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    _t2 = &_t0->val;
    _t3 = *_t2;
    cosf(_t3);
    _t5 = &_t1->val;
    *_t5 = _t4;
    _t6 = &_t0->val;
    _t7 = *_t6;
    sinf(_t7);
    _t9 = -_t8;
    _t10 = &_t0->deriv;
    _t11 = *_t10;
    _t12 = _t9 * _t11;
    _t13 = &_t1->deriv;
    *_t13 = _t12;
    return _t1;
}

struct Dual* dual_sqrt(struct Dual* _arg0) {
    float _t2;
    float _t8;
    float* _t11;
    float* _t1;
    float* _t6;
    float* _t7;
    int64_t _t10;
    int64_t _t3;
    int64_t _t4;
    int64_t _t9;
    struct Dual* _t0;
    struct Dual* _t5;
    
    _t0 = _arg0;
    _t1 = &_t0->val;
    _t2 = *_t1;
    sqrtf(_t2);
    _t4 = _t3;
    struct Dual _alloca__t5;
    _t5 = &_alloca__t5;
    _t6 = &_t5->val;
    *_t6 = _t4;
    _t7 = &_t0->deriv;
    _t8 = *_t7;
    _t9 = 2 * _t4;
    _t10 = _t8 / _t9;
    _t11 = &_t5->deriv;
    *_t11 = _t10;
    return _t5;
}

struct Dual* dual_pow(struct Dual* _arg0, float _arg1) {
    float _t14;
    float _t1;
    float _t3;
    float _t9;
    float* _t13;
    float* _t16;
    float* _t2;
    float* _t7;
    float* _t8;
    int64_t _t10;
    int64_t _t11;
    int64_t _t12;
    int64_t _t15;
    int64_t _t4;
    int64_t _t5;
    struct Dual* _t0;
    struct Dual* _t6;
    
    _t0 = _arg0;
    _t1 = _arg1;
    _t2 = &_t0->val;
    _t3 = *_t2;
    powf(_t3, _t1);
    _t5 = _t4;
    struct Dual _alloca__t6;
    _t6 = &_alloca__t6;
    _t7 = &_t6->val;
    *_t7 = _t5;
    _t8 = &_t0->val;
    _t9 = *_t8;
    _t10 = _t1 - 1;
    powf(_t9, _t10);
    _t12 = _t1 * _t11;
    _t13 = &_t0->deriv;
    _t14 = *_t13;
    _t15 = _t12 * _t14;
    _t16 = &_t6->deriv;
    *_t16 = _t15;
    return _t6;
}

struct Dual* dual_relu(struct Dual* _arg0) {
    float _t2;
    float* _t1;
    float* _t5;
    float* _t6;
    int64_t _t3;
    struct Dual* _t0;
    struct Dual* _t4;
    
    _t0 = _arg0;
    _t1 = &_t0->val;
    _t2 = *_t1;
    _t3 = _t2 > 0;
    if (_t3) goto L_then; else goto L_else;
L_then:
    return _t0;
L_else:
    goto L_merge;
L_merge:
    struct Dual _alloca__t4;
    _t4 = &_alloca__t4;
    _t5 = &_t4->val;
    *_t5 = 0;
    _t6 = &_t4->deriv;
    *_t6 = 0;
    return _t4;
}

struct Dual* dual_sigmoid(struct Dual* _arg0) {
    float _t13;
    float _t2;
    float _t3;
    float* _t12;
    float* _t15;
    float* _t1;
    float* _t9;
    int64_t _t10;
    int64_t _t11;
    int64_t _t14;
    int64_t _t4;
    int64_t _t5;
    int64_t _t6;
    int64_t _t7;
    struct Dual* _t0;
    struct Dual* _t8;
    
    _t0 = _arg0;
    _t1 = &_t0->val;
    _t2 = *_t1;
    _t3 = -_t2;
    expf(_t3);
    _t5 = 1 + _t4;
    _t6 = 1 / _t5;
    _t7 = _t6;
    struct Dual _alloca__t8;
    _t8 = &_alloca__t8;
    _t9 = &_t8->val;
    *_t9 = _t7;
    _t10 = 1 - _t7;
    _t11 = _t7 * _t10;
    _t12 = &_t0->deriv;
    _t13 = *_t12;
    _t14 = _t11 * _t13;
    _t15 = &_t8->deriv;
    *_t15 = _t14;
    return _t8;
}

struct Dual* dual_tanh(struct Dual* _arg0) {
    float _t15;
    float _t2;
    float* _t11;
    float* _t14;
    float* _t17;
    float* _t1;
    int64_t _t12;
    int64_t _t13;
    int64_t _t16;
    int64_t _t3;
    int64_t _t4;
    int64_t _t5;
    int64_t _t6;
    int64_t _t7;
    int64_t _t8;
    int64_t _t9;
    struct Dual* _t0;
    struct Dual* _t10;
    
    _t0 = _arg0;
    _t1 = &_t0->val;
    _t2 = *_t1;
    _t3 = 2 * _t2;
    expf(_t3);
    _t5 = _t4;
    _t6 = _t5 - 1;
    _t7 = _t5 + 1;
    _t8 = _t6 / _t7;
    _t9 = _t8;
    struct Dual _alloca__t10;
    _t10 = &_alloca__t10;
    _t11 = &_t10->val;
    *_t11 = _t9;
    _t12 = _t9 * _t9;
    _t13 = 1 - _t12;
    _t14 = &_t0->deriv;
    _t15 = *_t14;
    _t16 = _t13 * _t15;
    _t17 = &_t10->deriv;
    *_t17 = _t16;
    return _t10;
}

float mse_grad(float _arg0, float _arg1) {
    float _t0;
    float _t1;
    int64_t _t2;
    
    _t0 = _arg0;
    _t1 = _arg1;
    _t2 = _t0 - _t1;
    return _t2;
}

float cross_entropy_grad(float _arg0, float _arg1) {
    float _t0;
    float _t1;
    int64_t _t2;
    
    _t0 = _arg0;
    _t1 = _arg1;
    _t2 = _t0 - _t1;
    return _t2;
}

struct Dual* example_derivative(float _arg0) {
    float _t0;
    struct Dual* _t10;
    struct Dual* _t11;
    struct Dual* _t12;
    struct Dual* _t13;
    struct Dual* _t14;
    struct Dual* _t1;
    struct Dual* _t2;
    struct Dual* _t3;
    struct Dual* _t4;
    struct Dual* _t5;
    struct Dual* _t6;
    struct Dual* _t7;
    struct Dual* _t8;
    struct Dual* _t9;
    
    _t0 = _arg0;
    struct Dual _alloca__t1;
    _t1 = &_alloca__t1;
    dual_var(_t1, _t0);
    _t2 = _t1;
    struct Dual _alloca__t3;
    _t3 = &_alloca__t3;
    dual_const(_t3, 2);
    _t4 = _t3;
    struct Dual _alloca__t5;
    _t5 = &_alloca__t5;
    dual_const(_t5, 1);
    _t6 = _t5;
    struct Dual _alloca__t7;
    _t7 = &_alloca__t7;
    dual_mul(_t7, _t2, _t2);
    _t8 = _t7;
    struct Dual _alloca__t9;
    _t9 = &_alloca__t9;
    dual_mul(_t9, _t4, _t2);
    _t10 = _t9;
    struct Dual _alloca__t11;
    _t11 = &_alloca__t11;
    dual_add(_t11, _t8, _t10);
    _t12 = _t11;
    struct Dual _alloca__t13;
    _t13 = &_alloca__t13;
    dual_add(_t13, _t12, _t6);
    _t14 = _t13;
    return _t14;
}

